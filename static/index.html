<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Torn Ranked War Tracker</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Dead Fragment RW Tracker</h1>
        <div class="header-stats">
          <span id="connection-status" class="status-indicator connected"
            >‚óè Connected</span
          >
          <span id="last-update">Data age: --</span>
          <span id="api-calls">API: --/100</span>
        </div>
      </header>

      <!-- User Status Bar -->
      <div class="user-status-bar" id="user-status-bar">
        <a
          href="https://www.torn.com/factions.php?step=your#/tab=armoury&start=0&sub=medical"
          target="_blank"
          class="user-status-item clickable-stat"
          title="Go to Faction Medical"
        >
          <span class="user-status-label">‚ù§Ô∏è HP</span>
          <div class="bar-container health-bar">
            <div class="bar-fill" id="health-fill"></div>
            <span class="bar-text" id="health-text">--/--</span>
          </div>
        </a>
        <a
          href="https://www.torn.com/factions.php?step=your#/tab=armoury&start=0&sub=drugs"
          target="_blank"
          class="user-status-item clickable-stat"
          title="Go to Faction Drugs"
        >
          <span class="user-status-label">‚ö° E</span>
          <div class="bar-container energy-bar">
            <div class="bar-fill" id="energy-fill"></div>
            <span class="bar-text" id="energy-text">--/--</span>
          </div>
        </a>
        <a
          href="https://www.torn.com/crimes.php"
          target="_blank"
          class="user-status-item clickable-stat"
          title="Go to Crimes"
        >
          <span class="user-status-label">üí¢ N</span>
          <div class="bar-container nerve-bar">
            <div class="bar-fill" id="nerve-fill"></div>
            <span class="bar-text" id="nerve-text">--/--</span>
          </div>
        </a>
        <a
          href="https://www.torn.com/factions.php?step=your#/tab=armoury&start=0&sub=drugs"
          target="_blank"
          class="user-status-item cooldown-item clickable-stat"
          title="Go to Faction Drugs"
        >
          <span class="cooldown-label">üíä Drug</span>
          <span class="cooldown-value" id="drug-cd">--:--</span>
        </a>
        <a
          href="https://www.torn.com/factions.php?step=your#/tab=armoury&start=0&sub=medical"
          target="_blank"
          class="user-status-item cooldown-item clickable-stat"
          title="Go to Faction Medical"
        >
          <span class="cooldown-label">üè• Med</span>
          <span class="cooldown-value" id="medical-cd">--:--</span>
        </a>
        <a
          href="https://www.torn.com/factions.php?step=your#/tab=armoury&start=0&sub=boosters"
          target="_blank"
          class="user-status-item cooldown-item clickable-stat"
          title="Go to Faction Boosters"
        >
          <span class="cooldown-label">üíâ Boost</span>
          <span class="cooldown-value" id="booster-cd">--:--</span>
        </a>
        <a
          href="https://www.torn.com/factions.php?step=your#/war/chain"
          target="_blank"
          class="user-status-item chain-item clickable-stat"
          id="chain-item"
          title="Go to Faction Chain"
        >
          <span class="chain-label">‚õìÔ∏è Chain</span>
          <span class="chain-count" id="chain-count">0</span>
          <span class="chain-timer" id="chain-timer">--:--</span>
        </a>
        <!-- View Toggle (only shown if user has access) -->
        <div class="user-status-item view-toggle-compact" id="view-toggle" style="display: none;">
          <button class="toggle-btn-compact active" data-view="targets">Targets</button>
          <button class="toggle-btn-compact" data-view="faction">Faction</button>
        </div>
        <div class="user-status-item status-item" id="player-status-item">
          <span class="status-state" id="player-state">--</span>
        </div>
      </div>

      <!-- Chain Bonus Alert Overlay -->
      <div class="chain-alert-overlay" id="chain-alert-overlay">
        <div class="chain-alert-content">
          <span class="chain-alert-emoji">üî•</span>
          <span class="chain-alert-text" id="chain-alert-text"
            >CHAIN BONUS IN 10 HITS!</span
          >
          <span class="chain-alert-count" id="chain-alert-count">990/1000</span>
        </div>
      </div>

      <div class="config-panel" id="config-panel">
        <h3>Configuration</h3>
        <div class="config-form">
          <div class="form-group">
            <label for="api-key">Your API Key (Limited):</label>
            <input
              type="password"
              id="api-key"
              placeholder="Enter your Torn API key"
            />
            <small class="help-text"
              >Get it from
              <a
                href="https://www.torn.com/preferences.php#tab=api"
                target="_blank"
                >Torn Settings ‚Üí API</a
              ></small
            >
          </div>
          <div class="form-group">
            <label for="user-id">Your Torn ID:</label>
            <input
              type="number"
              id="user-id"
              placeholder="Enter your Torn ID"
            />
          </div>
          <div class="form-group">
            <label for="user-name">Your Name:</label>
            <input
              type="text"
              id="user-name"
              placeholder="Enter your Torn name"
            />
          </div>
          <button id="save-config" class="btn btn-primary">Save</button>
        </div>
      </div>

      <div class="controls">
        <div class="filter-section">
          <div class="filter-group">
            <span class="filter-label">Hospital:</span>
            <button
              class="filter-btn active"
              data-filter-type="hospital"
              data-value="all"
            >
              All
            </button>
            <button
              class="filter-btn"
              data-filter-type="hospital"
              data-value="in"
            >
              In
            </button>
            <button
              class="filter-btn"
              data-filter-type="hospital"
              data-value="out"
            >
              Out
            </button>
          </div>
          <div class="filter-group">
            <span class="filter-label">Claim:</span>
            <button
              class="filter-btn active"
              data-filter-type="claim"
              data-value="all"
            >
              All
            </button>
            <button
              class="filter-btn"
              data-filter-type="claim"
              data-value="unclaimed"
            >
              Unclaimed
            </button>
            <button
              class="filter-btn"
              data-filter-type="claim"
              data-value="claimed"
            >
              Claimed
            </button>
          </div>
          <div class="filter-group">
            <span class="filter-label">Status:</span>
            <button
              class="filter-btn active"
              data-filter-type="online"
              data-value="all"
            >
              All
            </button>
            <button
              class="filter-btn"
              data-filter-type="online"
              data-value="online"
            >
              Online
            </button>
            <button
              class="filter-btn"
              data-filter-type="online"
              data-value="offline"
            >
              Offline
            </button>
          </div>
          <div class="filter-group">
            <span class="filter-label">Travel:</span>
            <button
              class="filter-btn active"
              data-filter-type="travel"
              data-value="all"
            >
              All
            </button>
            <button
              class="filter-btn"
              data-filter-type="travel"
              data-value="local"
            >
              Local
            </button>
            <button
              class="filter-btn"
              data-filter-type="travel"
              data-value="traveling"
            >
              Traveling
            </button>
          </div>
        </div>

        <div class="range-filters">
          <div class="range-filter">
            <span class="filter-label">Level:</span>
            <input
              type="number"
              id="level-min"
              class="range-input"
              placeholder="Min"
              min="1"
              max="100"
            />
            <span class="range-separator">-</span>
            <input
              type="number"
              id="level-max"
              class="range-input"
              placeholder="Max"
              min="1"
              max="100"
            />
          </div>
          <div class="range-filter">
            <span class="filter-label">Stats:</span>
            <select id="stats-min" class="range-select">
              <option value="0">Min</option>
              <option value="25000">25K+</option>
              <option value="100000">100K+</option>
              <option value="250000">250K+</option>
              <option value="1000000">1M+</option>
              <option value="2000000">2M+</option>
              <option value="5000000">5M+</option>
              <option value="10000000">10M+</option>
              <option value="50000000">50M+</option>
              <option value="100000000">100M+</option>
              <option value="250000000">250M+</option>
              <option value="500000000">500M+</option>
              <option value="1000000000">1B+</option>
              <option value="2000000000">2B+</option>
              <option value="5000000000">5B+</option>
              <option value="10000000000">10B+</option>
            </select>
            <span class="range-separator">-</span>
            <select id="stats-max" class="range-select">
              <option value="999999999999">Max</option>
              <option value="25000">25K</option>
              <option value="100000">100K</option>
              <option value="250000">250K</option>
              <option value="1000000">1M</option>
              <option value="2000000">2M</option>
              <option value="5000000">5M</option>
              <option value="10000000">10M</option>
              <option value="50000000">50M</option>
              <option value="100000000">100M</option>
              <option value="250000000">250M</option>
              <option value="500000000">500M</option>
              <option value="1000000000">1B</option>
              <option value="2000000000">2B</option>
              <option value="5000000000">5B</option>
              <option value="10000000000">10B</option>
            </select>
          </div>
          <div class="action-controls">
            <button id="refresh-btn" class="btn btn-secondary">üîÑ Refresh</button>
            <button id="toggle-config" class="btn btn-secondary">
              ‚öôÔ∏è Settings
            </button>
          </div>
        </div>
      </div>

      <div class="stats-bar" id="stats-bar">
        <div class="stat clickable" data-stat-filter="total">
          <span class="stat-value" id="total-targets">0</span>
          <span class="stat-label">Total</span>
        </div>
        <div class="stat clickable" data-stat-filter="hospital">
          <span class="stat-value" id="in-hospital">0</span>
          <span class="stat-label">In Hospital</span>
        </div>
        <div class="stat clickable" data-stat-filter="out">
          <span class="stat-value" id="out-hospital">0</span>
          <span class="stat-label">Out</span>
        </div>
        <div class="stat clickable" data-stat-filter="claimed">
          <span class="stat-value" id="claimed-count">0</span>
          <span class="stat-label">Claimed</span>
        </div>
        <div class="stat clickable" data-stat-filter="traveling">
          <span class="stat-value" id="traveling-count">0</span>
          <span class="stat-label">Traveling</span>
        </div>
        <div
          class="stat clickable"
          id="my-claims-stat"
          data-stat-filter="myclaims"
        >
          <span class="stat-value" id="my-claims-count">0</span>
          <span class="stat-label">My Claims</span>
        </div>
      </div>

      <div class="main-layout">
        <!-- Main Content -->
        <div class="main-content">
          <!-- Enemy Targets Table -->
          <div class="target-table-container" id="targets-view">
            <table class="target-table" id="target-table">
              <thead>
                <tr>
                  <th class="sortable" data-sort="timer">
                    Timer <span class="sort-icon">‚ñº</span>
                  </th>
                  <th class="sortable" data-sort="name">
                    Name <span class="sort-icon"></span>
                  </th>
                  <th class="sortable" data-sort="level">
                    Lvl <span class="sort-icon"></span>
                  </th>
                  <th class="sortable" data-sort="stats">
                    Stats <span class="sort-icon"></span>
                  </th>
                  <th class="sortable" data-sort="online">
                    Status <span class="sort-icon"></span>
                  </th>
                  <th>Reason</th>
                  <th class="sortable" data-sort="claimed">
                    Claimed <span class="sort-icon"></span>
                  </th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="target-list">
                <tr>
                  <td colspan="8" class="loading">Loading targets...</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Faction Overview Table (hidden by default) -->
          <div class="faction-overview-container" id="faction-view" style="display: none;">
            <table class="faction-table" id="faction-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th class="sortable" data-sort="level">Level<span class="sort-icon"></span></th>
                  <th class="sortable" data-sort="status">Status<span class="sort-icon"></span></th>
                  <th class="sortable" data-sort="life">Ô∏èLife<span class="sort-icon"></span></th>
                  <th class="sortable" data-sort="energy">Energy<span class="sort-icon"></span></th>
                  <th class="sortable" data-sort="drug">Drug CD<span class="sort-icon"></span></th>
                  <th class="sortable" data-sort="medical">Med CD<span class="sort-icon"></span></th>                  
                  <th class="sortable" data-sort="booster">Boost CD<span class="sort-icon"></span></th>                  
                  <th class="sortable" data-sort="hospital">Hospital <span class="sort-icon"></span></th>
                  <th class="sortable" data-sort="lastseen">Last Seen<span class="sort-icon"></span></th>
                </tr>
              </thead>
              <tbody id="faction-list">
                <tr>
                  <td colspan="10" class="loading">Loading faction data...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div id="toast-container"></div>

    <script src="/static/factionOverview.js"></script>
    <script src="/static/app.js"></script>
  </body>
</html>
